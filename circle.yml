machine:
  python:
    version: 3.5.2
  environment:
    GIT_AUTHOR_NAME: Pior Bastida (CircleCI)
    GIT_AUTHOR_EMAIL: pior@pbastida.net

dependencies:
  pre:
  override:
    - pip install -U wheel bumpversion twine
    - pip install -r requirements-test.txt
    - pip install -e .

test:
  override:
    - pytest
    - pylama
  post:
    - coverage report > $CIRCLE_ARTIFACTS/coverage.txt


deployment:
  pypi:
    branch: pypi
    commands:
      - bumpversion patch --commit --tag
      - git push origin pypi --tags
      - git push origin master --tags
      - python setup.py sdist bdist_wheel
      - twine upload -u $PYPI_USERNAME -p $PYPI_PASSWORD dist/*
